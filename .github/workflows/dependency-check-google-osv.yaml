name: dependency-check-google-osv

on:
  push:
    paths: &shared-trigger-paths
      - 'package.json'
      - 'package-lock.json'
      - 'ios/**'
      - 'android/**'
      - '**/*.gradle'
      - '**/Podfile*'
      - '**/Package*.swift'
      - '.github/dependency-check-google-osv.yaml'
    branches:
      - main
      - develop
      - 'releases/**'
  pull_request:
    types: [ opened, synchronize ]
    paths: *shared-trigger-paths
  workflow_dispatch:

jobs:
  depcheck:
    permissions:
      actions: read
      security-events: write
      contents: read

    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v5
      with:
        submodules: recursive

    - name: Ignore services folder
      run: |
        echo 'services/*' >> .gitignore

    - name: Run Google OSV Scanner
      uses: docker://ghcr.io/google/osv-scanner-action:v2.2.2
      args: |-
          --recursive
          ./
